const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwjsZvKw71THdomH18AXMR-GI0aETKI30Erz7xK19lT4vSeaaaPFdSZuPIJm2UU09DG/exec";

const form = document.getElementById("formAsset");
const fotoInput = document.getElementById("foto");
const preview = document.getElementById("preview");
let fotoBase64 = "";

// Preview foto
fotoInput.addEventListener("change", function() {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      fotoBase64 = e.target.result.split(",")[1]; // ambil bagian base64 saja
      preview.innerHTML = `<img src="${e.target.result}" alt="Preview Foto">`;
    };
    reader.readAsDataURL(file);
  }
});

// Submit form
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    tanggal: document.getElementById("tanggal").value,
    item: document.getElementById("item").value,
    qty: document.getElementById("qty").value,
    keterangan: document.getElementById("keterangan").value,
    foto: fotoBase64
  };

  try {
    const response = await fetch(APP_SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain" },
      body: JSON.stringify(data)
    });

    const text = await response.text();
    const result = JSON.parse(text.match(/JSON\.stringify\((.*)\)/)[1]);
    if (result.status === "ok") {
      document.getElementById('status').innerText = "✅ Data berhasil dikirim!";
      form.reset();
      preview.innerHTML = "";
    } else {
      document.getElementById('status').innerText = "⚠ Gagal: " + result.message;
    }
  } catch (error) {
    document.getElementById('status').innerText = "❌ Error koneksi: " + error.message;
  }

});
