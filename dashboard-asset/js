const form = document.getElementById("formAsset");
const fotoInput = document.getElementById("foto");
const preview = document.getElementById("preview");
let fotoFile = null;

// Preview foto
fotoInput.addEventListener("change", function() {
  const file = this.files[0];
  if (file) {
    fotoFile = file;
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.innerHTML = `<img src="${e.target.result}" alt="Preview Foto">`;
    };
    reader.readAsDataURL(file);
  }
});

// Submit form
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    tanggal: document.getElementById("tanggal").value,
    item: document.getElementById("item").value,
    qty: document.getElementById("qty").value,
    keterangan: document.getElementById("keterangan").value
  };

  try {
    // Save data to Firestore
    await window.addDoc(window.collection(window.db, "assets"), data);

    // Upload foto to Firebase Storage if exists
    if (fotoFile) {
      const storageRef = window.ref(window.storage, `assets/${data.item}.jpg`);
      await window.uploadBytes(storageRef, fotoFile);
    }

    document.getElementById('status').innerText = "✅ Data berhasil dikirim!";
    form.reset();
    preview.innerHTML = "";
    fotoFile = null;
  } catch (error) {
    document.getElementById('status').innerText = "❌ Error: " + error.message;
  }
});
