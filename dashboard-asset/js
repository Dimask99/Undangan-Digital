const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8zugc5zceMzhoeaPV79vn1cCLL52WFIN09vNkAnh5QcTA9up-yNeZRzyJjDiDUPs/exec";

document.getElementById('formData').addEventListener('submit', async (e) => {
  e.preventDefault();

  const fotoFile = document.getElementById('foto').files[0];

  // Jika tidak ada foto, kirim data biasa
  if (!fotoFile) {
    sendData(null);
    return;
  }

  // Ubah foto menjadi Base64
  const reader = new FileReader();
  reader.onloadend = () => {
    const base64Foto = reader.result.split(',')[1]; // hapus prefix data:image
    sendData(base64Foto);
  };
  reader.readAsDataURL(fotoFile);
});

async function sendData(fotoBase64) {
  const data = {
    tanggal: document.getElementById('tanggal').value,
    item: document.getElementById('item').value,
    qty: document.getElementById('qty').value,
    keterangan: document.getElementById('keterangan').value,
    foto: fotoBase64 || "" // bisa kosong
  };

  try {
    await fetch(APP_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    document.getElementById('status').innerText = "✅ Data berhasil dikirim!";
    document.getElementById('formData').reset();
  } catch (error) {
    document.getElementById('status').innerText = "❌ Gagal mengirim data.";
  }
}
